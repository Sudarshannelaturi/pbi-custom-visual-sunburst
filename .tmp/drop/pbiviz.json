{"visual":{"name":"demoSunburst","displayName":"Custom Sunburst","guid":"demoSunburst4BB94EA0EE28445F8BE8DD3925E23D23","visualClassName":"Visual","version":"1.0.0","description":"Getting started with Power BI custom visuals.","supportUrl":"www.justinkolpak.com","gitHubUrl":""},"author":{"name":"Justin Kolpak","email":"jkolpak@wmp.com"},"apiVersion":"2.6.0","style":"style/visual.less","stringResources":{},"capabilities":{"dataRoles":[{"displayName":"Child","description":"Unique identifier of the child entity in the hierarchy","kind":"Grouping","name":"Child"},{"displayName":"Parent","description":"Unique identifier of the parent entity in the hierarchy","kind":"Grouping","name":"Parent"},{"displayName":"Label","description":"Field to label each entity in the hierarchy","kind":"Grouping","name":"Label"},{"displayName":"Values","description":"Determines the color of the entity","kind":"Measure","name":"Values"}],"dataViewMappings":[{"conditions":[{"Child":{"max":1},"Parent":{"max":1},"Label":{"max":1},"Values":{"max":1}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Child"}},{"for":{"in":"Parent"}},{"for":{"in":"Label"}},{"for":{"in":"Values"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"############### Utility functions ###############\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\n}\n\nlibraryRequireInstall(\"XML\")\nlibraryRequireInstall(\"htmlwidgets\")\n\ninternalSaveWidget <- function(widget, fname)\n{\n  tempFname = paste(fname, \".tmp\", sep=\"\")\n  htmlwidgets::saveWidget(widget, file = tempFname, selfcontained = FALSE)\n  FlattenHTML(tempFname, fname)\n}\n\nFlattenHTML <- function(fnameIn, fnameOut)\n{\n  # Read and parse HTML file\n  # Embed all js and css files into one unified file\n  \n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn, useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(fname)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s) = 'src'\n      newNode = xmlNode(\"script\",attrs = s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(fname);\n      if (!is.null(str))\n      {      \n        newNode = xmlNode(\"script\", str, attrs = c(type = \"text/javascript\"))\n        replaceNodes(node, newNode)\n      }\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['href'])\n    str = ReadFileForEmbedding(fname, FALSE);\n    if (!is.null(str))\n    {\n      newNode = xmlNode(\"style\", str)\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  saveXML(html, file = fnameOut)\n  return(TRUE)\n}\n\nReadFileForEmbedding <- function(fname, addCdata = TRUE)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  if (addCdata) {\n    str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  }\n  return(str)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n  \n  con = file(fname, open = \"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nFindSrcReplacement <- function(str)\n{\n  # finds reference to 'plotly' js and replaces with a version from CDN\n  # This allows the HTML to be smaller, since this script is not fully embedded in it\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes') <- FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch) == 0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes') <- FALSE\n  strmatch = regmatches(strMatch[1], match2)\n  if (length(strmatch) == 0) return(NULL)\n  \n  # CDN url is https://cdn.plot.ly/plotly-<Version>.js\n  # This matches the specific version used in the plotly package used.\n  verstr = substr(strmatch, 2, nchar(strmatch)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n#################################################\n\n\n############### Library Declarations ###############\nlibraryRequireInstall(\"plotly\")\n####################################################\n\n################### Actual code ####################\n\n## Helper Functions\n\n## Declare variables from user input \n\n# Required Inputs\nchild <- Child[,1]\nparent <- Parent[,1]\nlabel <- Label[,1]\nvalues <- Values[,1]\n\n# Can use objects from capabilities.json with syntax of <object>_<property>\nif(exists(\"sunburst_maxDepth\")){\n  maxDepth = sunburst_maxDepth\n} else {\n  maxDepth = -1\n}\n\nif(exists(\"sunburst_colorValue1\")){\n  color1 = sunburst_colorValue1\n} else {\n  color1 = '#FD817E'\n}\n\nif(exists(\"sunburst_colorValue2\")){\n  color2 = sunburst_colorValue2\n} else {\n  color2 = '#FAEFC1'\n}\n\nif(exists(\"sunburst_colorValue3\")){\n  color3 = sunburst_colorValue3\n} else {\n  color3 = '#4CB437'\n}\n\n# Tooltip\n#tooltip_1 <- Tooltip[,1]\n#tooltip_2 <- Tooltip[,2]\n#tooltip_1_colname <- colnames(Tooltip)[1]\n#tooltip_2_colname <- colnames(Tooltip)[2]\n\ncolors <- ifelse(values == 1, color1,\n    ifelse(values == 2,color2,\n      ifelse(values == 3,color3, '#AFB6B6')\n    )\n  )\n\n# Build sunburst visual\nsunburstDiagram <- plot_ly() %>%\n  add_trace(\n    type = 'sunburst'\n    , name = 'test'\n    , ids = child\n    , labels = label\n    , parents = parent\n    , marker = list(\n      colors = colors\n    )\n    , hovertext = paste(\"Score:\", values)\n    , maxdepth = maxDepth\n    #domain = list(column = 0)\n    , showlegend = TRUE)\n\n####################################################\n\n############# Create and save widget ###############\ninternalSaveWidget(sunburstDiagram, 'out.html');\n####################################################\n"}}}],"objects":{"sunburst":{"displayName":"Sunburst Settings","properties":{"maxDepth":{"displayName":"Max Depth","description":"Select the number of hierarchy levels to display.","type":{"numeric":true}},"colorValue1":{"displayName":"Value 1 Color","description":"Color of nodes where value is 1.","type":{"fill":{"solid":{"color":true}}}},"colorValue2":{"displayName":"Value 2 Color","description":"Color of nodes where value is 2.","type":{"fill":{"solid":{"color":true}}}},"colorValue3":{"displayName":"Value 3 Color","description":"Color of nodes where value is 3.","type":{"fill":{"solid":{"color":true}}}}}},"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"HTML Widgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"},{"name":"XML","displayName":"XML","url":"https://cran.r-project.org/web/packages/XML/index.html"}]},"content":{"js":"var demoSunburst4BB94EA0EE28445F8BE8DD3925E23D23=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"assets\",n(n.s=12)}([function(e,t,n){\"use strict\";(function(e){n.d(t,\"b\",(function(){return o})),n.d(t,\"a\",(function(){return i})),n.d(t,\"c\",(function(){return u}));var r=0;function o(){r=0}function i(e,t){var n=[];if(e&&e.hasChildNodes()){for(var r=e.children,o=0;o<r.length;o++){var i=void 0;i=\"script\"===r.item(o).nodeName.toLowerCase()?a(r.item(o)):r.item(o).cloneNode(!0),t.appendChild(i),n.push(i)}return n}}function a(e){for(var t=document.createElement(\"script\"),n=e.attributes,o=0;o<n.length;o++)t.setAttribute(n[o].name,n[o].textContent),\"src\"===n[o].name.toLowerCase()&&(r++,t.onload=function(){r--});return t.innerHTML=e.innerHTML,t}function u(){var t=e.setInterval((function(){0===r&&(e.clearInterval(t),e.hasOwnProperty(\"HTMLWidgets\")&&e.HTMLWidgets.staticRender&&e.HTMLWidgets.staticRender())}),100)}}).call(this,n(4))},function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return a}));var r=n(2);function o(e){return(o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(e,t,n){return e?r.a(e[t.objectName],t.propertyName,n):n}function a(e,t,n){var r=i(e,t,n);return r&&r.solid?r.solid.color:null==r||\"object\"===o(r)&&!r.solid?n:r}},function(e,t,n){\"use strict\";function r(e,t,n){if(!e)return n;var r=e[t];return void 0===r?n:r}n.d(t,\"a\",(function(){return r}))},function(e,t,n){\"use strict\";function r(e){return(r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function o(e,t){return!t||\"object\"!==r(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}n.d(t,\"a\",(function(){return f}));var s=n(7).a.DataViewObjectsParser,c=function e(){u(this,e),this.maxDepth=5,this.colorValue1=\"#FD817E\",this.colorValue2=\"#FAEFC1\",this.colorValue3=\"#4CB437\"},f=function(e){function t(){var e;return u(this,t),(e=o(this,i(t).apply(this,arguments))).sunburst=new c,e}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),t}(s)},function(e,t){e.exports=Function(\"return this\")()},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",(function(){return s}));var r,o=n(3),i=n(0);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Data=2]=\"Data\",e[e.Resize=4]=\"Resize\",e[e.ViewMode=8]=\"ViewMode\",e[e.Style=16]=\"Style\",e[e.ResizeEnd=32]=\"ResizeEnd\",e[e.All=62]=\"All\"}(r||(r={}));var u=[r.Resize,r.ResizeEnd,r.Resize+r.ResizeEnd],s=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),e&&e.element&&(this.rootElement=e.element),this.headNodes=[],this.bodyNodes=[]}var n,r,s;return n=t,s=[{key:\"parseSettings\",value:function(e){return o.a.parse(e)}}],(r=[{key:\"update\",value:function(e){if(e&&e.type&&e.viewport&&e.dataViews&&0!==e.dataViews.length&&e.dataViews[0]){var n=e.dataViews[0];this.settings=t.parseSettings(n);var r=null;n.scriptResult&&n.scriptResult.payloadBase64&&(r=n.scriptResult.payloadBase64),-1===u.indexOf(e.type)?r&&this.injectCodeFromPayload(r):this.onResizing(e.viewport)}}},{key:\"onResizing\",value:function(e){}},{key:\"injectCodeFromPayload\",value:function(t){if(Object(i.b)(),t){var n=document.createElement(\"html\");try{n.innerHTML=e.atob(t)}catch(e){return}if(0===this.headNodes.length){for(;this.headNodes.length>0;){var r=this.headNodes.pop();document.head.removeChild(r)}var o=n.getElementsByTagName(\"head\");if(o&&o.length>0){var a=o[0];this.headNodes=Object(i.a)(a,document.head)}}for(;this.bodyNodes.length>0;){var u=this.bodyNodes.pop();this.rootElement.removeChild(u)}var s=n.getElementsByTagName(\"body\");if(s&&s.length>0){var c=s[0];this.bodyNodes=Object(i.a)(c,this.rootElement)}Object(i.c)()}}},{key:\"enumerateObjectInstances\",value:function(e){return o.a.enumerateObjectInstances(this.settings||o.a.getDefault(),e)}}])&&a(n.prototype,r),s&&a(n,s),t}()}).call(this,n(4))},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"DataViewObjectsParser\",(function(){return i}));var r=n(1);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e)}var t,n,i;return t=e,i=[{key:\"getDefault\",value:function(){return new this}},{key:\"createPropertyIdentifier\",value:function(e,t){return{objectName:e,propertyName:t}}},{key:\"parse\",value:function(e){var t,n=this.getDefault();if(!e||!e.metadata||!e.metadata.objects)return n;for(var o in t=n.getProperties())for(var i in t[o]){var a=n[o][i];n[o][i]=r.a(e.metadata.objects,t[o][i],a)}return n}},{key:\"isPropertyEnumerable\",value:function(t){return!e.InnumerablePropertyPrefix.test(t)}},{key:\"enumerateObjectInstances\",value:function(e,t){var n=e&&e[t.objectName];if(!n)return[];var r={objectName:t.objectName,selector:null,properties:{}};for(var o in n)n.hasOwnProperty(o)&&(r.properties[o]=n[o]);return{instances:[r]}}}],(n=[{key:\"getProperties\",value:function(){var t=this,n={};return Object.keys(this).forEach((function(r){if(e.isPropertyEnumerable(r)){var o=Object.keys(t[r]);n[r]={},o.forEach((function(t){e.isPropertyEnumerable(r)&&(n[r][t]=e.createPropertyIdentifier(r,t))}))}})),n}}])&&o(t.prototype,n),i&&o(t,i),e}();i.InnumerablePropertyPrefix=/^_/},function(e,t,n){\"use strict\";var r=n(6);n.d(t,\"a\",(function(){return r}))},,,,,function(e,t,n){e.exports=n(13)},function(e,t,n){\"use strict\";n.r(t),function(e){var r=n(5),o=e.powerbi,i={name:\"demoSunburst4BB94EA0EE28445F8BE8DD3925E23D23\",displayName:\"Custom Sunburst\",class:\"Visual\",apiVersion:\"2.6.0\",create:function(e){if(r.a)return new r.a(e);throw\"Visual instance not found\"},custom:!0};void 0!==o&&(o.visuals=o.visuals||{},o.visuals.plugins=o.visuals.plugins||{},o.visuals.plugins.demoSunburst4BB94EA0EE28445F8BE8DD3925E23D23=i),t.default=i}.call(this,n(4))}]);\n//# sourceMappingURL=visual.js.map","css":"","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAAASySURBVDhPbZRrbFRVFIW/uTOdmXY6bdqhWFpK5VXeFCohiIBEbAANWohCeJhojMbwVyUmGBPwh1FCophUI/wQo6RpjRg1vEpL5S0tKDSk0AYKlPJoy/T9mOnce1wzQ4wx7uTk3Jmzzzp7r732JlLxiol9gTEPd5to/XdmdIdlojs9xrl7ziTsqMeYQzo/PdWY8D5jGvKMqcEc3TzW3C93G1Ots3+Z5d1QhZ1dhn3gXVIWLMHJXwqWB6duJwkLlYKj3XJrj0C0g9uNfgIZMXKn2LCkPekXt+vbsOK7d8tB7JxXcfZNIuXNY5hYFOfa4YQPoRVJQE8a2N0Qi9FyKci8xWEo+hT8eUm/xtcxd3YlAePm3VxJLG0D/BzA2nJcF4Vz4WsYu1pAcgjMhL46wjchK9Srn0VQuC15uX4pTsd+XOlKhO5fkn/KvJsqiEXK8PTshuKN2Ce2Q5qA4oDeMTB8mZaLAeYti0LJ9cQdc6YQhk5jZcGjZq8Am19WuPPFzYOEQ4o4HW314Zk/BdMfxvT1QtAFrkGi9/sI+gdxv9iY8OWkD5fnDiMDLs7vDdJyOQuX+WuGwRmGyC0YsxGmHEj42oe3KDrl0OXgLuoUaArN31ZRtPk9mLoLTrsSNWo85mfUymT6qgzSJ/kFeB6DJ05lhpYiiYn48R9D/oc4F3dh1+8nZdVr0PMDdy8MMv7tG3DcxY16xeAaQ1FpGp78heBbCellApQxID4GTj5ep8TV7Ti7MLcauzWMdfdHuvtPkf38V3RUrCXiL6Bg5Rsq2Evyeyqe0D+WBPw/i+qRXknHI+Lvu4moIHY0TKB4vQr0pM6a9LjWoNZQC2a4VYFE/wPYL030acX3gTYIN0s7XYwGLYZG0xkKp9F58Ses0RECKnqqKpsaVLai2q+dQDzCyomGXqFLd6gZEqnGhRx/pngxTmYqvTcsIiaX3FmKJrCBvv7VtNeUc6+2HMe4sITocvtwW/pm5GESPqiixJ8iFSaEYN1HUJBPa2UNmTNLVfB7dNwsk9i+JCO8nBlrS1hRYVi4/VfGzZ6Fa6QL44QV4fcZko3CiSjEXAFPHisg9XHHNzyqPYITeoGMiePwZmXx596DlGzdJErEbURq6FRmC05A5jIFoitHdyizfWnGVIWMuTLTmFtrjBn8w5imBcbUqgne0iQZqTP9v+WY2MNK0/oJ5kHDGWPOPWFMy3JjmpcZUyefEznGDN+Ll8NYzFXrFOdCjvo4pN68JTk8auByTTrTSvSs71nsrk7NBMOExZlc3bMGFkmLbXWqgAjPWw7ZyqpaQ+LKenGYNgrj9qrnJIW2d9QZ1+lrV4u324SeW6sUBnHUy/ZgK1ahuPSFeXBWw6Pwfangml5UBf3ZMF3A4YMCnN4A3VUC+lwkSC4um/pDIeY8rXYcL07Ch7F1xwyJr0ApE+ZBU/k6mPSZtKiWHBkQqGrgKLD8ZwR4e6sEeTZJsHuYppNBvL4YoWnyS5ujlqtO1MyJCze4gjz9H424aT+iWVgqkJuXhBfXm8yJCTCmodAlTiI99LSlcOdqKrMXqYIFj2ddTy22Uk5E6Jus9CSGqak07/9Ah+r9+Xug9Xd9qqWAvwHG4iPLzn58bAAAAABJRU5ErkJggg=="},"visualEntryPoint":""}